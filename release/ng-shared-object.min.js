/*! ng-shared-object 0.0.1 | Copyright (c) 2015 Jeremie Pardou | MIT License */(function(){"use strict";angular.module("ngSharedObject",["vxWamp"]).factory("sharedObject",["$rootScope","$log","$q","$wamp","$timeout",function(a,b,c,d,e){var f,g,h,i,j,k,l,m;return l=!1,j=null,m="",k={},i=function(){},h=function(a,c,e){return b.debug("Propagating change..."),d.publish(m+"context.newValue",[a,c,e])},g=function(a,e,g){var i;return i=c.defer(),b.debug("Ask change to master..."),d.call(m+"context.changeValue",[a,e,g]).then(function(c){return c.success?(b.debug("Change Success"),h(a,e,g),i.resolve()):(b.info("Change failed. Reverting..."),i.reject(),f[a]=c.data,k[a]=angular.copy(c.data))}),i.$promise},f={$reset:function(){var a,b,c;c=[];for(a in f)b=f[a],c.push("$"===a[0]||delete f[a]);return c},$sync:function(){return d.call(m+"context.all",[]).then(function(a){return b.debug("Ask all data"),angular.extend(f,a),k=angular.copy(f)})},$init:function(a,c){return null==c&&(c=!1),m=a,l=c,c?(d.register(m+"context.changeValue",function(a){var c,d,e;return c=a[0],d=a[1],e=a[2],b.debug("Change asked"),angular.equals(f[c],e)||void 0===f[c]?(b.debug("Change accepted"),f[c]=d,{success:!0}):(b.info("Change canceled"),{success:!1,data:f[c]})}),d.register(m+"context.all",function(a){return b.debug("Send all data"),f}),i=h):(i=g,this.$sync()),d.subscribe(m+"context.newValue",function(a){var c,d,e;return b.info("Change propagated"),c=a[0],d=a[1],e=a[2],f[c]=d,k[c]=angular.copy(d)})}},a.$watch(function(){return j||(j=e(function(){var a,b;if(j=null,!angular.equals(f,k)){for(a in f)b=f[a],"$"===a[0]||angular.equals(f[a],k[a])||i(a,b,k[a]);return k=angular.copy(f)}},1e3))}),f}])}).call(this);